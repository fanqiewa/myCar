<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>千行后台管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" type="text/css" href="http://apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" type="text/css" href="http://cdn.bootcss.com/font-awesome/4.6.0/css/font-awesome.min.css">
    <!-- Simplify -->
    <link href="css/simplify.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./layui/css/layui.css">
    <link rel="stylesheet" href="./css/back_base.css">
    <link rel="stylesheet" href="./css/back_base.css">
    <style>
        .layui-upload-img {
            width: 110px;
            height: 92px;
            margin: 0 10px 10px 0;
        }
        #editor {
            height: 300px;
        }
        label {
            box-sizing: content-box;
        }
    </style>
</head>

<body class="overflow-hidden">
<div class="wrapper preload">

    <header class="top-nav">
        <div class="top-nav-inner">
            <div class="nav-header">
                <button type="button" class="navbar-toggle pull-left sidebar-toggle" id="sidebarToggleSM">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <ul class="nav-notification pull-right">
                    <li>
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-cog fa-lg"></i></a>
                        <span class="badge badge-danger bounceIn">1</span>
                        <ul class="dropdown-menu dropdown-sm pull-right user-dropdown">
                            <li class="user-avatar">
                                <img src="images/profile1.jpg" alt="" class="img-circle">
                                <div class="user-content">
                                    <h5 class="no-m-bottom">Jane Doe</h5>
                                    <div class="m-top-xs">
                                        <a href="profile.html" class="m-right-sm">Profile</a>
                                        <a href="">Log out</a>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <a href="">
                                    Inbox
                                    <span class="badge badge-danger bounceIn animation-delay2 pull-right">1</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    Notification
                                    <span class="badge badge-purple bounceIn animation-delay3 pull-right">2</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="sidebarRight-toggle">
                                    Message
                                    <span class="badge badge-success bounceIn animation-delay4 pull-right">7</span>
                                </a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <a href="#">Setting</a>
                            </li>
                        </ul>
                    </li>
                </ul>

                <a href="back_index.html" class="brand">
                    <i class="fa fa-database"></i><span class="brand-name">千行后台管理</span>
                </a>
            </div>
            <div class="nav-container">
                <button type="button" class="navbar-toggle pull-left sidebar-toggle" id="sidebarToggleLG">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <ul class="nav-notification">
                    <li class="search-list">
                        <div class="search-input-wrapper">
                            <div class="search-input">
                                <input type="text" class="form-control input-sm inline-block">
                                <a href="#" class="input-icon text-normal"><i class="ion-ios7-search-strong"></i></a>
                            </div>
                        </div>
                    </li>
                </ul>
                <div class="pull-right m-right-sm">
                    <div class="user-block hidden-xs" id="admin">

                    </div>
                    <ul class="nav-notification">
                        <li>
                            <a href="#" data-toggle="dropdown"><i class="fa fa-envelope fa-lg"></i></a>
                            <span class="badge badge-purple bounceIn animation-delay5 active suggest"></span>
                            <ul class="dropdown-menu message pull-right sug_list">
                                <li><a>You have <span class="suggest"></span> new unread messages</a></li>

                                <!--<li>-->
                                    <!--<a class="clearfix" href="#">-->
                                        <!--<img src="images/profile1.jpg" alt="User Avatar">-->
                                        <!--<div class="detail">-->
                                            <!--<strong>Baby Doe</strong>-->
                                            <!--<p class="no-margin">-->
                                                <!--Lorem ipsum dolor sit amet...-->
                                            <!--</p>-->
                                            <!--<small class="text-muted"><i class="fa fa-reply"></i> 9 Feb 2013</small>-->
                                        <!--</div>-->
                                    <!--</a>-->
                                <!--</li>-->
                                <!--<li><a href="#">View all messages</a></li>-->
                            </ul>
                        </li>
                        <li>
                            <a href="#" data-toggle="dropdown"><i class="fa fa-bell fa-lg"></i></a>
                            <span class="badge badge-info bounceIn animation-delay6 active public"></span>
                            <ul class="dropdown-menu notification dropdown-3 pull-right pub_list">
                                <li><a href="#">You have <span class="public"></span> new notifications</a></li>

                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div><!-- ./top-nav-inner -->
    </header>
    <aside class="sidebar-menu fixed">
        <div class="sidebar-inner scrollable-sidebar">
            <div class="main-menu">
                <ul class="accordion">
                    <li class="menu-header">
                        Main Menu
                    </li>
                    <li class="bg-palette1">
                        <a href="back_index.html">
									<span class="menu-content block">
										<span class="menu-icon"><i class="block fa fa-home fa-lg"></i></span>
										<span class="text m-left-sm">主页</span>
									</span>
                            <span class="menu-content-hover block">
										Home
									</span>
                        </a>
                    </li>
                    <li class="bg-palette2">
                        <a href="#l">
									<span class="menu-content block">
										<span class="menu-icon"><i class="block fa fa-desktop fa-lg"></i></span>
										<span class="text m-left-sm">控制台</span>
									</span>
                            <span class="menu-content-hover block">
										控制台
									</span>
                        </a>
                    </li>
                    <li class="openable bg-palette3">
                        <a href="#">
									<span class="menu-content block">
										<span class="menu-icon"><i class="block fa fa-list fa-lg"></i></span>
										<span class="text m-left-sm">新闻管理</span>
										<span class="submenu-icon"></span>
									</span>
                            <span class="menu-content-hover block">
										新闻管理
									</span>
                        </a>
                        <ul class="submenu bg-palette4">
                            <li><a href="back_newsList.html"><span class="submenu-label">新闻列表</span></a></li>
                            <li><a href="back_addNews.html"><span class="submenu-label">添加新闻</span></a></li>
                        </ul>
                    </li>
                    <li class="openable bg-palette4 open">
                        <a href="#">
									<span class="menu-content block">
										<span class="menu-icon"><i class="block fa fa-tags fa-lg"></i></span>
										<span class="text m-left-sm">产品管理</span>
										<span class="submenu-icon"></span>
									</span>
                            <span class="menu-content-hover block">
										产品管理
									</span>
                        </a>
                        <ul class="submenu">
                            <li><a href="back_productList.html"><span class="submenu-label">产品列表</span></a></li>
                            <li class="active"><a href="back_addProduct.html"><span class="submenu-label">产品添加</span></a></li>
                            <li><a href="back_addFDT.html"><span class="submenu-label">其他</span></a></li>
                        </ul>
                    </li>
                    <li class="bg-palette1">
                        <a href="back_suggestList.html">
									<span class="menu-content block">
										<span class="menu-icon"><i class="block fa fa-envelope fa-lg"></i></span>
										<span class="text m-left-sm">留言信息</span>
										<small class="badge badge-danger badge-square bounceIn animation-delay5 m-left-xs allSuggest"></small>
									</span>
                            <span class="menu-content-hover block">
										留言信息
									</span>
                        </a>
                    </li>
                    <li class="menu-header">
                        Others
                    </li>
                    <li class="openable bg-palette3">
                        <a href="#">
									<span class="menu-content block">
										<span class="menu-icon"><i class="block fa fa-gift fa-lg"></i></span>
										<span class="text m-left-sm">用户管理</span>
										<span class="submenu-icon"></span>
									</span>
                            <span class="menu-content-hover block">
										用户管理
									</span>
                        </a>
                        <ul class="submenu">
                            <li><a href="back_addUser.html"><span class="submenu-label">管理员添加</span></a></li>
                            <li><a href=""><span class="submenu-label">基本信息</span></a></li>
                        </ul>
                    </li>
                    <li class="openable bg-palette4">
                        <a href="#">
									<span class="menu-content block">
										<span class="menu-icon"><i class="block fa fa-list fa-lg"></i></span>
										<span class="text m-left-sm">公告管理</span>
										<span class="submenu-icon"></span>
									</span>
                            <span class="menu-content-hover block">
										公告管理
									</span>
                        </a>
                        <ul class="submenu">
                            <li><a href="back_publicList.html"><span class="submenu-label">公告列表</span></a></li>
                            <li><a href="back_addPublic.html"><span class="submenu-label">公告添加</span></a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="sidebar-fix-bottom clearfix">
                <div class="user-dropdown dropup pull-left">
                    <a href="#" class="dropdwon-toggle font-18" data-toggle="dropdown"><i class="ion-person-add"></i>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="">
                                Inbox
                                <span class="badge badge-danger bounceIn animation-delay2 pull-right">1</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Notification
                                <span class="badge badge-purple bounceIn animation-delay3 pull-right">2</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="sidebarRight-toggle">
                                Message
                                <span class="badge badge-success bounceIn animation-delay4 pull-right">7</span>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">Setting</a>
                        </li>
                    </ul>
                </div>
                <a href="lockscreen.html" class="pull-right font-18"><i class="ion-log-out"></i></a>
            </div>
        </div><!-- sidebar-inner -->
    </aside>

    <div class="main-container">
        <!-- 内容主体区域 -->
        <div class="box_content">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>产品上传</legend>
            </fieldset>
            <div class="layui-form">
                <div class="layui-form-item">
                    <label class="layui-form-label">产品类别</label>
                    <div class="layui-input-block">
                        <select name="city" lay-verify="required" id="select1">
                            <!--<option value="0">北京</option>-->
                            <!--<option value="1">上海</option>-->
                            <!--<option value="2">广州</option>-->
                            <!--<option value="3">深圳</option>-->
                            <!--<option value="4">杭州</option>-->
                        </select>
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">产品价格</label>
                <div class="layui-input-block">
                    <input type="text" name="username"  placeholder="请输入产品价格" autocomplete="off" class="layui-input" id="product_price">
                </div>
            </div>
            <div class="layui-form">
                <div class="layui-form-item">
                    <label class="layui-form-label">产品型号</label>
                    <div class="layui-input-block">
                        <select name="city" lay-verify="required" id="select2">
                            <!--<option value="0">北京</option>-->
                            <!--<option value="1">上海</option>-->
                            <!--<option value="2">广州</option>-->
                            <!--<option value="3">深圳</option>-->
                            <!--<option value="4">杭州</option>-->
                        </select>
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">产品图片</label>
                <img class="layui-upload-img" id="demo1">
                <button type="button" class="layui-btn" id="test1" onclick="selectFile()"><i class="layui-icon">&#xe67c;</i>上传图片</button>
                <input type="file" name="product_image" id="product_image" style="display:none" onchange="changepic(this)" accept="image/gif,image/jpeg,image/jpg,image/png,image/svg">
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">一句话描述</label>
                <div class="layui-input-block">
                    <input type="text" name="username"  placeholder="请输入简短的文字描述一下产品特点" autocomplete="off" class="layui-input" id="product_describe">
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">产品介绍</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入内容" class="layui-textarea" id="editor"></textarea>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" onclick="submit()" >立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary" onclick="reset()">重置</button>
                </div>
            </div>
        </div>
    </div><!-- /main-container -->

    <footer class="footer">
				<span class="footer-brand">
					<strong class="text-danger">千行</strong> 所有
				</span>
        <p class="no-margin">
            Copyright © 2014.Company name All rights reserved.
        </p>
    </footer>
</div><!-- /wrapper -->



<!-- Le javascript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->

<!-- Jquery -->
<script src="js/jquery.min.js"></script>

<!-- Bootstrap -->
<script src="js/bootstrap.min.js"></script>


<!-- Slimscroll -->
<script src='js/jquery.slimscroll.min.js'></script>


<!-- Simplify -->
<script src="js/simplify.js"></script>
<!-- <script src="js/simplify/simplify_dashboard.js"></script> -->
<script src="./layui/layui.all.js"></script>

<script>
    //请求类别：
    layui.use(['form'],function () {
        var layer = layui.layer;
        var form = layui.form;
        function queryCategory() {
            $.ajax({
                type: "get",
                url: "/api/queryAllCategory",
                success : function (data) {
                    if(JSON.parse(data).msg == "Fail") {
                        window.location.href = "login.html"
                    }
                    renderSelect(JSON.parse(data).data)
                },
                error : function (error) {
                    console.log(error)
                }
            });
            function renderSelect(data) {
                var str = "";
                var len = data.length;
                for(var i = 0; i < len; i ++) {
                    str += "<option value=\""+ data[i].id +"\">" + data[i].category_name + "</option>"
                }
                $("#select1").append(str);
                form.render();
            }
        }
        queryCategory();

        function queryVersion() {
            $.ajax({
                type: "get",
                url: "/queryAllVersion",
                success : function (data) {
                    renderSelect(JSON.parse(data).data)
                },
                error : function (error) {
                    console.log(error)
                }
            });
            function renderSelect(data) {
                var str = "";
                var len = data.length;
                for(var i = 0; i < len; i ++) {
                    str += "<option value=\""+ data[i].id +"\">" + data[i].product_version + "</option>"
                }
                $("#select2").append(str);
                form.render();
            }
        }
        queryVersion()
    })

</script>


<script>
    function selectFile() {
        $("#product_image").trigger("click");
    }
    function changepic() {
        var reads= new FileReader();
        f=document.getElementById('product_image').files[0];
        reads.readAsDataURL(f);
        reads.onload=function (e) {
            document.getElementById('demo1').src=this.result;
        };
    }
    function submit() {
        var category_name = $("#select1 option:selected").text();
        var product_version = $("#select2 option:selected").text();
        var product_describe = $("#product_describe").val();
        var product_price = $("#product_price").val();
        var product_image = document.getElementById("product_image").files[0];
        var content = $("#editor").val();
        var changeContent = content.replace(/<img[^>]*>/g,"");
        var form = new FormData();
        var imageType = /^image\//;
        if(category_name == "" || product_version == "" || product_describe == "" || product_price == "") {
            alert("描述 or 价格 or 内容不能为空！");
            return;
        }
        if(product_image == undefined) {
            alert("请添加图片！");
            return;

        }
        if(!imageType.test(product_image.type)) {//判断是否为图片
            alert("请选择图片类型文件！！！")
            return;
        }
        form.append("product_image",product_image);
        form.append("content",content);
        $.ajax({
            url:"/addProduct?category_name=" + category_name + "&product_price=" + product_price + "&product_describe=" + product_describe + "&product_version=" + product_version,
            type:"POST",
            data:form,
            processData:false,
            contentType: false,
            success:function (resp) {
                if(JSON.parse(resp).msg == "该车型已存在,请重新选择！") {
                    layer.msg(JSON.parse(resp).msg, {icon: 5});
                } else if(JSON.parse(resp).msg == "添加成功"){
                    layer.msg("已成功添加一条数据！", {icon: 1});
                }
                $("#product_describe").val("");
                $("#editor").val("");
                $("#product_price").val("");

            },
            error:function (resp) {
                console.log(resp)
            }
        })

    }
    function reset() {
        layer.msg("重置成功！");
        $("#product_describe").val("");
        $("#editor").val("");
        $("#product_price").val("");
    }
</script>
<script src="js/base_ajax.js"></script>
</body>
</html>
